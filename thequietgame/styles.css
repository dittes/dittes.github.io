/* ============================================
   THE QUIET GAME — Styles v2
   Zen observatory · atmospheric dark UI
   ============================================ */

:root {
  --bg: #08090d;
  --bg2: #0e1016;
  --surface: #161820;
  --surface2: #1e2029;
  --border: #282a36;
  --border-hi: #3a3d4d;

  --text: #e4e2dc;
  --text2: #9b98a0;
  --text3: #5c5960;
  --text4: #3a3840;

  --gold: #c9a84c;
  --gold-dim: rgba(201, 168, 76, 0.12);
  --gold-glow: rgba(201, 168, 76, 0.25);

  --green: #3ee88a;
  --green-bg: #071e12;
  --green-dim: rgba(62, 232, 138, 0.10);

  --red: #f0544a;
  --red-bg: #1e0a0b;
  --red-dim: rgba(240, 84, 74, 0.10);

  --amber: #e8a840;

  --font-serif: 'Cormorant Garamond', 'Georgia', serif;
  --font-mono: 'JetBrains Mono', 'SF Mono', 'Fira Code', 'Consolas', monospace;

  --r: 14px;
  --r-sm: 8px;
  --r-full: 999px;
  --speed: 0.22s;
}

/* ---- Reset ---- */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { font-size: 16px; -webkit-text-size-adjust: 100%; }

body {
  font-family: var(--font-mono);
  font-weight: 400;
  font-size: 0.82rem;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow: hidden;
  -webkit-font-smoothing: antialiased;
}

button {
  font-family: inherit;
  font-size: inherit;
  border: none;
  cursor: pointer;
  outline: none;
  background: none;
  color: inherit;
  -webkit-tap-highlight-color: transparent;
}
button:focus-visible { outline: 2px solid var(--gold); outline-offset: 2px; }

fieldset { border: none; }
a { color: var(--gold); text-decoration: none; }
a:hover { text-decoration: underline; }
strong { font-weight: 500; color: var(--text); }

/* Utility */
.mono {
  font-family: var(--font-mono);
  font-variant-numeric: tabular-nums;
  font-feature-settings: 'tnum' 1;
}

/* ---- App Shell ---- */
#app {
  position: relative;
  width: 100%;
  min-height: 100dvh;
}

.screen {
  display: none;
  flex-direction: column;
  min-height: 100dvh;
  padding: 20px;
  padding-top: max(20px, env(safe-area-inset-top));
  padding-bottom: max(20px, env(safe-area-inset-bottom));
}
.screen.active {
  display: flex;
  animation: screenIn 0.45s ease;
}
@keyframes screenIn {
  from { opacity: 0; transform: translateY(6px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ============================================
   PROGRESS BORDER — SVG rect tracing viewport
   ============================================ */
.progress-border {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 50;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.5s ease;
}
.progress-border.visible { opacity: 1; }

#progress-rect {
  fill: none;
  stroke: var(--gold);
  stroke-width: 4;
  filter: drop-shadow(0 0 8px var(--gold-glow));
  transition: stroke 0.3s ease;
}
.progress-border.danger #progress-rect {
  stroke: var(--red);
  filter: drop-shadow(0 0 10px var(--red-dim));
}

/* ============================================
   IDLE SCREEN
   ============================================ */
#screen-idle {
  justify-content: space-between;
  gap: 20px;
}

.idle-header { text-align: center; padding-top: clamp(24px, 6vh, 56px); }

.title-row {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 12px;
  position: relative;
}

.game-title {
  font-family: var(--font-serif);
  font-size: clamp(3rem, 11vw, 5.5rem);
  font-weight: 300;
  line-height: 0.95;
  letter-spacing: -0.03em;
  color: var(--text);
}
.game-title em {
  font-weight: 300;
  font-style: italic;
  color: var(--gold);
}

.btn-icon {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  color: var(--text3);
  transition: color var(--speed), background var(--speed);
  flex-shrink: 0;
  margin-top: 8px;
}
.btn-icon:hover { color: var(--text); background: var(--surface); }

.game-subtitle {
  margin-top: 10px;
  font-size: 0.7rem;
  font-weight: 400;
  color: var(--text3);
  letter-spacing: 0.2em;
  text-transform: uppercase;
}

/* Body */
.idle-body {
  display: flex;
  flex-direction: column;
  gap: 32px;
  max-width: 420px;
  width: 100%;
  margin: 0 auto;
}

.field-group { display: flex; flex-direction: column; }

.section-label {
  font-size: 0.65rem;
  font-weight: 500;
  color: var(--text3);
  letter-spacing: 0.14em;
  text-transform: uppercase;
  margin-bottom: 12px;
}

/* Duration */
.duration-options {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
}
.duration-btn {
  padding: 14px 4px;
  border-radius: var(--r-sm);
  background: var(--surface);
  border: 1px solid var(--border);
  font-size: 0.82rem;
  color: var(--text2);
  transition: all var(--speed);
}
.duration-btn:hover { background: var(--surface2); color: var(--text); }
.duration-btn.selected {
  background: var(--gold-dim);
  border-color: var(--gold);
  color: var(--gold);
}

/* Threshold */
.threshold-row {
  display: flex;
  align-items: center;
  gap: 14px;
}
.threshold-value {
  font-family: var(--font-mono);
  font-size: 0.82rem;
  color: var(--gold);
  min-width: 50px;
  text-align: right;
}

/* Range */
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 28px;
  background: transparent;
}
input[type="range"]:focus-visible { outline: 2px solid var(--gold); outline-offset: 4px; }

input[type="range"]::-webkit-slider-runnable-track {
  height: 3px;
  background: linear-gradient(to right, var(--border) 0%, var(--border-hi) 100%);
  border-radius: 2px;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 20px; height: 20px;
  border-radius: 50%;
  background: var(--gold);
  border: 3px solid var(--bg);
  box-shadow: 0 0 0 1px var(--border-hi), 0 0 12px var(--gold-dim);
  margin-top: -8.5px;
  cursor: pointer;
}
input[type="range"]::-moz-range-track {
  height: 3px;
  background: var(--border);
  border-radius: 2px;
  border: none;
}
input[type="range"]::-moz-range-thumb {
  width: 20px; height: 20px;
  border-radius: 50%;
  background: var(--gold);
  border: 3px solid var(--bg);
  box-shadow: 0 0 0 1px var(--border-hi);
  cursor: pointer;
}

.threshold-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 12px;
}
.btn-text {
  font-size: 0.72rem;
  color: var(--text3);
  transition: color var(--speed);
  display: flex;
  align-items: center;
  gap: 6px;
}
.btn-text:hover { color: var(--text2); }

.calibrate-dot {
  display: inline-block;
  width: 7px; height: 7px;
  border-radius: 50%;
  background: var(--text3);
  transition: background var(--speed);
}
.calibrating .calibrate-dot {
  background: var(--amber);
  animation: pulseDot 0.5s ease infinite alternate;
}
@keyframes pulseDot {
  from { opacity: 1; transform: scale(1); }
  to   { opacity: 0.3; transform: scale(0.7); }
}

.calibrate-status {
  font-size: 0.72rem;
  color: var(--amber);
  min-height: 1.3em;
  margin-top: 6px;
}

/* Start */
.btn-start {
  width: 100%;
  padding: 20px;
  border-radius: var(--r);
  background: var(--text);
  color: var(--bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  transition: transform var(--speed), box-shadow var(--speed);
  position: relative;
}
.btn-start:hover { box-shadow: 0 4px 30px rgba(228, 226, 220, 0.12); }
.btn-start:active { transform: scale(0.97); }
.btn-start-label {
  font-family: var(--font-serif);
  font-size: 1.5rem;
  font-weight: 400;
  letter-spacing: 0.02em;
}
.btn-start-sub {
  font-size: 0.62rem;
  opacity: 0.45;
  letter-spacing: 0.06em;
}

/* Footer */
.idle-footer { text-align: center; }
.privacy-note {
  font-size: 0.6rem;
  color: var(--text4);
  line-height: 1.5;
  letter-spacing: 0.02em;
}

/* ============================================
   RUNNING SCREEN
   ============================================ */
#screen-running {
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  position: relative;
}

/* Subtle radial glow */
#screen-running::before {
  content: '';
  position: absolute;
  top: 30%; left: 50%;
  width: 120%; height: 60%;
  transform: translate(-50%, -50%);
  background: radial-gradient(ellipse, rgba(201, 168, 76, 0.03), transparent 65%);
  pointer-events: none;
}

.running-top {
  text-align: center;
  padding-top: 10px;
  z-index: 1;
}

.timer-display {
  font-family: var(--font-mono);
  font-weight: 300;
  font-size: clamp(3.2rem, 15vw, 7rem);
  line-height: 1;
  letter-spacing: -0.02em;
  color: var(--text);
}

.running-hint {
  font-size: 0.7rem;
  color: var(--text3);
  letter-spacing: 0.18em;
  text-transform: uppercase;
  margin-top: 6px;
}

/* Paused */
.paused-state .running-hint::after { content: ' — paused'; color: var(--amber); }
.paused-state .timer-display { animation: blinkTimer 1.4s steps(1) infinite; }
@keyframes blinkTimer {
  0%, 100% { opacity: 1; }
  50%      { opacity: 0.25; }
}

/* Viz */
.running-middle {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 24px;
  z-index: 1;
}

.viz-wrap {
  position: relative;
  width: clamp(200px, 52vw, 320px);
  height: clamp(200px, 52vw, 320px);
}
#viz-canvas {
  width: 100%; height: 100%;
  display: block;
}
.viz-center {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: 1px;
  pointer-events: none;
}
.viz-level {
  font-size: clamp(1.1rem, 3.5vw, 1.6rem);
  font-weight: 500;
  color: var(--text);
}
.viz-unit {
  font-size: 0.55rem;
  color: var(--text3);
  text-transform: uppercase;
  letter-spacing: 0.2em;
}

/* Stats */
.running-stats {
  display: flex;
  align-items: center;
  gap: 28px;
}
.stat { display: flex; flex-direction: column; align-items: center; gap: 2px; }
.stat-val { font-size: 0.88rem; color: var(--text); }
.stat-lbl { font-size: 0.58rem; color: var(--text3); text-transform: uppercase; letter-spacing: 0.14em; }
.stat-div { width: 1px; height: 24px; background: var(--border); }

/* Controls */
.running-bottom {
  display: flex;
  gap: 12px;
  width: 100%;
  max-width: 400px;
  z-index: 1;
}
.btn-ctrl {
  flex: 1;
  padding: 15px 20px;
  border-radius: var(--r);
  font-size: 0.85rem;
  font-weight: 500;
  transition: all var(--speed);
}
.btn-pause {
  background: var(--surface);
  border: 1px solid var(--border);
}
.btn-pause:hover { background: var(--surface2); }
.btn-stop {
  background: var(--red-dim);
  border: 1px solid rgba(240, 84, 74, 0.2);
  color: var(--red);
}
.btn-stop:hover { background: rgba(240, 84, 74, 0.14); }

/* ============================================
   RESULT SCREENS
   ============================================ */
#screen-win, #screen-lose {
  justify-content: center;
  align-items: center;
  transition: background 0.6s ease;
}
#screen-win  { background: var(--green-bg); }
#screen-lose { background: var(--red-bg); }

.result-wrap {
  text-align: center;
  max-width: 380px;
  width: 100%;
  animation: resultPop 0.5s cubic-bezier(0.22, 1, 0.36, 1);
}
@keyframes resultPop {
  from { opacity: 0; transform: scale(0.88); }
  to   { opacity: 1; transform: scale(1); }
}

.result-badge {
  font-size: 3.2rem;
  line-height: 1;
  margin-bottom: 20px;
}
.result-badge-win  { color: var(--green); text-shadow: 0 0 50px var(--green-dim); }
.result-badge-lose { color: var(--red); text-shadow: 0 0 50px var(--red-dim); }

.result-title {
  font-family: var(--font-serif);
  font-size: clamp(2.6rem, 10vw, 4.2rem);
  font-weight: 300;
  line-height: 1.1;
}
.result-title-win  { color: var(--green); }
.result-title-lose { color: var(--red); }

.result-msg {
  font-size: 0.82rem;
  color: var(--text2);
  margin-top: 6px;
}

.result-stats {
  display: flex;
  justify-content: center;
  gap: 32px;
  margin-top: 48px;
  padding: 20px;
  background: rgba(0, 0, 0, 0.35);
  border-radius: var(--r);
  border: 1px solid rgba(255,255,255,0.04);
}
.result-stat { display: flex; flex-direction: column; gap: 4px; }
.rs-label { font-size: 0.58rem; color: var(--text3); text-transform: uppercase; letter-spacing: 0.12em; }
.rs-value { font-size: 0.95rem; color: var(--text); }

.btn-again {
  margin-top: 36px;
  padding: 14px 48px;
  border-radius: var(--r-full);
  font-family: var(--font-serif);
  font-size: 1.2rem;
  font-weight: 400;
  transition: all var(--speed);
}
.btn-again-win {
  background: var(--green);
  color: #052e16;
}
.btn-again-win:hover { box-shadow: 0 0 36px var(--green-dim); }
.btn-again-lose {
  background: var(--red);
  color: #fff;
}
.btn-again-lose:hover { box-shadow: 0 0 36px var(--red-dim); }

/* ============================================
   OVERLAYS (Mic Error + Info)
   ============================================ */
.overlay {
  position: fixed;
  inset: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(8, 9, 13, 0.92);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  padding: 20px;
  animation: fadeIn 0.25s ease;
}
.overlay[hidden] { display: none; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.overlay-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 36px 28px;
  max-width: 400px;
  width: 100%;
  text-align: center;
  position: relative;
}

.overlay-box-info {
  max-width: 460px;
  text-align: left;
  max-height: 85dvh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.overlay-icon { font-size: 2.4rem; margin-bottom: 14px; }

.overlay-box h3 {
  font-family: var(--font-serif);
  font-size: 1.4rem;
  font-weight: 400;
  margin-bottom: 14px;
}

.overlay-box p {
  font-size: 0.78rem;
  color: var(--text2);
  line-height: 1.65;
}

.mic-steps {
  text-align: left;
  padding-left: 20px;
  margin: 16px 0 24px;
}
.mic-steps li {
  font-size: 0.76rem;
  color: var(--text2);
  line-height: 1.8;
}

.btn-overlay-close {
  padding: 10px 32px;
  border-radius: var(--r-full);
  background: var(--surface2);
  border: 1px solid var(--border);
  font-size: 0.82rem;
  color: var(--text);
  transition: background var(--speed);
}
.btn-overlay-close:hover { background: var(--border); }

.btn-modal-close {
  position: absolute;
  top: 14px; right: 14px;
  width: 32px; height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  color: var(--text3);
  transition: color var(--speed), background var(--speed);
}
.btn-modal-close:hover { color: var(--text); background: var(--surface2); }

/* Info modal content */
.info-title {
  font-family: var(--font-serif);
  font-size: 1.6rem;
  font-weight: 300;
  margin-bottom: 24px;
  color: var(--text);
}

.info-section { margin-bottom: 20px; }
.info-section h4 {
  font-family: var(--font-serif);
  font-size: 1rem;
  font-weight: 400;
  color: var(--gold);
  margin-bottom: 6px;
}
.info-section p {
  font-size: 0.76rem;
  color: var(--text2);
  line-height: 1.7;
}

.info-divider {
  border: none;
  border-top: 1px solid var(--border);
  margin: 24px 0;
}

.imprint p {
  font-size: 0.76rem;
  color: var(--text2);
  line-height: 1.7;
  margin-bottom: 4px;
}

/* ============================================
   RESPONSIVE
   ============================================ */
@media (min-width: 768px) {
  .screen { padding: 32px; }
  .result-stats { gap: 48px; }
}

@media (max-height: 640px) {
  .idle-header { padding-top: 12px; }
  .game-title { font-size: 2.4rem; }
  .idle-body { gap: 20px; }
  .btn-start { padding: 14px; }
  .running-top { padding-top: 4px; }
  .viz-wrap { width: 160px; height: 160px; }
  .running-middle { gap: 14px; }
}

@media (max-height: 500px) and (orientation: landscape) {
  #screen-running {
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 10px;
    padding: 10px 20px;
  }
  .running-top { padding-top: 0; }
  .timer-display { font-size: 2.6rem; }
  .viz-wrap { width: 130px; height: 130px; }
  .running-bottom { max-width: 280px; }
}
